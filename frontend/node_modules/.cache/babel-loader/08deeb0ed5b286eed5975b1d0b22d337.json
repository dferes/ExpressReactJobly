{"ast":null,"code":"import axios from \"axios\";\nimport cloneDeep from 'lodash/cloneDeep';\nconst BASE_URL = process.env.REACT_APP_BASE_URL || \"http://localhost:3001\";\n/** API Class.\n *\n * Static class tying together methods used to get/send to to the API.\n * There shouldn't be any frontend-specific stuff here, and there shouldn't\n * be any API-aware stuff elsewhere in the frontend.\n *\n */\n\nclass JoblyApi {\n  static async request(endpoint, data = {}, method = \"get\") {\n    const url = `${BASE_URL}/${endpoint}`;\n    const headers = {\n      Authorization: `Bearer ${this.getToken()}`\n    };\n    const params = data;\n\n    try {\n      return (await axios({\n        url,\n        method,\n        data,\n        params,\n        headers\n      })).data;\n    } catch (err) {\n      console.error(\"API Error:\", err.response);\n      let message = err.response.data.error.message;\n      throw Array.isArray(message) ? message : [message];\n    }\n  }\n  /** Checks user's username and the password passed with the \n   * form data and, if valid, returns a token signed with jwt.\n   * The payload is the username and password.\n   * Note that the token is also updated in this class.\n   */\n\n\n  static async logIn(formData) {\n    const {\n      username,\n      password\n    } = formData;\n    const data = {\n      username: username,\n      password: password\n    };\n    let res = await this.request('auth/token', data, 'post');\n    this.setToken(res.token);\n    return res.token;\n  }\n  /** If all data passed in formData is valid, a new user is created\n   *  and added to the database (the user table). A token is created \n   *  and signed with jwt. The payload is the username and password.\n   *  Note that the token is also updated in this class. \n  */\n\n\n  static async signup(formData) {\n    const {\n      username,\n      password,\n      firstName,\n      lastName,\n      email\n    } = formData; // why did I do this?? Just pass formData...\n\n    const data = {\n      username: username,\n      password: password,\n      firstName: firstName,\n      lastName: lastName,\n      email: email\n    };\n    let res = await this.request('auth/register', data, 'post');\n    this.setToken(res.token);\n    return res.token;\n  }\n  /** Accepts { username, firstname, lastName, email, password }\n   *  and can update { firstName, lastName, email } in the database\n   *  and will return { firstName, lastName, email }. Only username\n   *  and password are required.\n   */\n\n\n  static async update(formData) {\n    // rename this to updateUser\n    const {\n      username,\n      password\n    } = formData;\n    await this.request( // Verify the password is correct before updating user\n    'auth/token', {\n      username: username,\n      password: password\n    }, 'post');\n    const data = cloneDeep(formData);\n    delete data.username;\n    delete data.password;\n    let res = await this.request(`users/${formData.username}`, data, 'patch');\n    return res.user;\n  }\n\n  static async applyToJob(username, jobId) {\n    let res = await this.request(`users/${username}/jobs/${jobId}`, {\n      username: username,\n      id: jobId\n    }, 'post');\n    return res.applied;\n  }\n  /** Get details on a company by handle. */\n\n\n  static async getCompany(handle) {\n    let res = await this.request(`companies/${handle}`);\n    return res.company;\n  }\n  /** Get details on either all companies or companies \n   *  that have a similar name to data.name **/\n\n\n  static async getAllCompanies(data = {}) {\n    let res = await this.request('companies/', data);\n    return res.companies;\n  }\n  /** Get details on a job by id */\n\n\n  static async getJob(id) {\n    let res = await this.request(`jobs/${id}`);\n    return res.job;\n  }\n  /** Get details on either all jobs or jobs \n  *  that have a similar title to data.title **/\n\n\n  static async getAllJobs(data = {}) {\n    let res = await this.request('jobs/', data);\n    return res.jobs;\n  }\n  /** Get details on a user by username */\n\n\n  static async getUser(username) {\n    let res = await this.request(`users/${username}`);\n    return res.user;\n  }\n\n}\n\nJoblyApi.setToken = token_ => JoblyApi.token = token_;\n\nJoblyApi.getToken = () => JoblyApi.token;\n\nexport default JoblyApi;","map":{"version":3,"sources":["/home/__NORI__/Documents/Springboard/43/react_jobly/jobly/src/api.js"],"names":["axios","cloneDeep","BASE_URL","process","env","REACT_APP_BASE_URL","JoblyApi","request","endpoint","data","method","url","headers","Authorization","getToken","params","err","console","error","response","message","Array","isArray","logIn","formData","username","password","res","setToken","token","signup","firstName","lastName","email","update","user","applyToJob","jobId","id","applied","getCompany","handle","company","getAllCompanies","companies","getJob","job","getAllJobs","jobs","getUser","token_"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport cloneDeep from 'lodash/cloneDeep';\n\nconst BASE_URL = process.env.REACT_APP_BASE_URL || \"http://localhost:3001\";\n\n/** API Class.\n *\n * Static class tying together methods used to get/send to to the API.\n * There shouldn't be any frontend-specific stuff here, and there shouldn't\n * be any API-aware stuff elsewhere in the frontend.\n *\n */\n\nclass JoblyApi {\n\n  static token;\n\n  static setToken = (token_) => this.token = token_;\n\n  static getToken = () => this.token;\n\n  static async request(endpoint, data = {}, method = \"get\") {\n    const url = `${BASE_URL}/${endpoint}`;\n    const headers = { Authorization: `Bearer ${this.getToken()}` };\n    const params = data;\n    try {\n      return (await axios({ url, method, data, params, headers })).data;\n    } catch (err) {\n      console.error(\"API Error:\", err.response);\n      let message = err.response.data.error.message;\n      throw Array.isArray(message) ? message : [message];\n    }\n  }\n\n  /** Checks user's username and the password passed with the \n   * form data and, if valid, returns a token signed with jwt.\n   * The payload is the username and password.\n   * Note that the token is also updated in this class.\n   */ \n  static async logIn(formData) {\n    const { username, password } = formData;\n    const data = {\n      username: username,\n      password: password\n    };\n \n    let res = await this.request(\n      'auth/token', \n      data,\n      'post'\n    );\n    \n    this.setToken(res.token);\n    return res.token;\n  }\n\n   /** If all data passed in formData is valid, a new user is created\n    *  and added to the database (the user table). A token is created \n    *  and signed with jwt. The payload is the username and password.\n    *  Note that the token is also updated in this class. \n   */ \n  static async signup(formData){\n    const { username, password, firstName, lastName, email } = formData; // why did I do this?? Just pass formData...\n    const data = {\n      username: username,\n      password: password,\n      firstName: firstName,\n      lastName: lastName, \n      email: email\n    };\n\n    let res = await this.request(\n      'auth/register',\n      data,\n      'post'\n    );\n\n    this.setToken(res.token);  \n    return res.token;\n  }\n\n  /** Accepts { username, firstname, lastName, email, password }\n   *  and can update { firstName, lastName, email } in the database\n   *  and will return { firstName, lastName, email }. Only username\n   *  and password are required.\n   */ \n  static async update(formData) { // rename this to updateUser\n    const { username, password } = formData;\n \n    await this.request( // Verify the password is correct before updating user\n      'auth/token', \n      { username: username, password: password },\n      'post'\n    );\n\n    const data = cloneDeep(formData);\n    delete data.username;\n    delete data.password;\n      \n    let res = await this.request(\n      `users/${formData.username}`, \n      data,\n      'patch'\n    );\n      \n    return res.user;\n  }\n\n  static async applyToJob(username, jobId) {\n    let res = await this.request(\n      `users/${username}/jobs/${jobId}`,\n      { username: username, id: jobId },\n      'post'\n    );\n\n    return res.applied;\n  }\n\n  /** Get details on a company by handle. */\n  static async getCompany(handle) {\n    let res = await this.request(`companies/${handle}`);\n    return res.company;\n  }\n\n  /** Get details on either all companies or companies \n   *  that have a similar name to data.name **/\n  static async getAllCompanies(data={}) {\n    let res = await this.request('companies/', data);\n    return res.companies;\n  }\n\n  /** Get details on a job by id */\n  static async getJob(id) {\n    let res = await this.request(`jobs/${id}`);\n    return res.job;\n  }\n\n  /** Get details on either all jobs or jobs \n  *  that have a similar title to data.title **/\n  static async getAllJobs(data={}) {\n    let res = await this.request('jobs/', data);\n    return res.jobs;\n  }\n\n  /** Get details on a user by username */\n  static async getUser(username) {\n    let res = await this.request(`users/${username}`);\n    return res.user;\n  }\n\n}\n\n\nexport default JoblyApi;"]},"metadata":{},"sourceType":"module"}